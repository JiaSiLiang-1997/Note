# DNS解析

DNS解析的过程就是寻找哪台机器上有你需要资源的过程。当你在浏览器中输入一个地址时，例如www.baidu.com，其实不是百度网站真正意义上的地址。互联网上每一台计算机的唯一标识是它的IP地址，但是IP地址并不方便记忆。用户更喜欢用方便记忆的网址去寻找互联网上的其它计算机，也就是上面提到的百度的网址。所以互联网设计者需要在用户的方便性与可用性方面做一个权衡，这个权衡就是一个网址到IP地址的转换，这个过程就是DNS解析。它实际上充当了一个翻译的角色，实现了网址到IP地址的转换。网址到IP地址转换的过程是如何进行的?

## 解析过程

DNS解析是一个递归查询的过程。

![1618288278-57f00bf9444dd_fix732](https://jsl1997.oss-cn-beijing.aliyuncs.com/note/1618288278-57f00bf9444dd_fix732.png)

上述图片是查找www.google.com的IP地址过程。首先在本地域名服务器中查询IP地址，如果没有找到的情况下，本地域名服务器会向根域名服务器发送一个请求，如果根域名服务器也不存在该域名时，本地域名会向com顶级域名服务器发送一个请求，依次类推下去。直到最后本地域名服务器得到google的IP地址并把它缓存到本地，供下次查询使用。从上述过程中，可以看出网址的解析是一个从右向左的过程: com -> google.com -> www.google.com。但是你是否发现少了点什么，根域名服务器的解析过程呢？事实上，真正的网址是www.google.com.，并不是我多打了一个.，这个.对应的就是根域名服务器，默认情况下所有的网址的最后一位都是.，既然是默认情况下，为了方便用户，通常都会省略，浏览器在请求DNS的时候会自动加上，所有网址真正的解析过程为: . -> .com -> google.com. -> www.google.com.。

## DNS优化

了解了DNS的过程，可以为我们带来哪些？上文中请求到google的IP地址时，经历了8个步骤，这个过程中存在多个请求(同时存在UDP和TCP请求，为什么有两种请求方式，请自行查找)。如果每次都经过这么多步骤，是否太耗时间？如何减少该过程的步骤呢？那就是DNS缓存。

**DNS缓存**：DNS存在着多级缓存，从离浏览器的距离排序的话，有以下几种: **浏览器缓存**，**系统缓存**，**路由器缓存**，**IPS服务器缓存**，**根域名服务器缓存**，**顶级域名服务器缓存**，**主域名服务器缓存**。

**DNS负载均衡**：DNS返回的IP地址是否每次都一样？如果每次都一样是否说明你请求的资源都位于同一台机器上面，那么这台机器需要多高的性能和储存才能满足亿万请求呢？其实真实的互联网世界背后存在成千上百台服务器，大型的网站甚至更多。但是在用户的眼中，它需要的只是处理他的请求，哪台机器处理请求并不重要。DNS可以返回一个合适的机器的IP给用户，例如可以根据每台机器的负载量，该机器离用户地理位置的距离等等，这种过程就是DNS负载均衡，又叫做DNS重定向。大家耳熟能详的CDN(Content Delivery Network)就是利用DNS的重定向技术，DNS服务器会返回一个跟用户最接近的点的IP地址给用户，CDN节点的服务器负责响应用户的请求，提供所需的内容。

# dns错误怎么解决？

dns错误怎么解决的问题可以严格按照以下步骤进行处理：

1.在桌面右键点击“网络”，然后点击“属性”进入到网络属性设置中。

2.进入到网络设置区域，在左方，点击“更改适配器设置”。

3.进入到网络设置中，右键点击“无线网络连接”，然后点击“属性”。注意，不是含有wifi的那个。

4.在网络栏目下，点击“Internet协议版本4”，然后点击右下角的“属性”。

5.然后点击“使用下面的IP地址”。

6.点击计算机“开始”，然后点击“运行”。

7.在运行中输入“cmd”，然后点击“确定”。

8.复制引号内内容“ipconfig/all”，然后进入刚才打开的“管理员”界面，右键点击，选择“粘贴”。

9.点击“回车”进入到信息界面。

10.找到“ipv4地址”可以看到后面的ip地址，

11.记住这里的ip

12.回到刚才的界面，在ip地址中输入刚才的ip地址然后点击“确定”。

# 怎么排查及解决dns解析故障？

## 一、用nslookup来判断是否真的是DNS解析故障

1、确认系统是windows 2000和windows xp以上操作系统，然后通过“开始-》运行-》输入CMD”后回车进入命令行模式。

2、输入nslookup命令后回车，将进入DNS解析查询界面。

3、命令行窗口中会显示出当前系统所使用的DNS服务器地址，如小编的Dns服务器IP为118.123.8.174。

4、接下来输入你无法访问的站点对应的域名。例如小编输入 [http://www.www.51web.com](http://www.www.51web.com/)， 假如不能访问的话，那么DNS解析应该是不能够正常进行的。 我们会收到DNS request timed out，timeout was 2 seconds的提示信息。这说明我们的计算机确实出现了DNS解 析故障。如果DNS解析正常的话，会反馈回正确的IP地址。

## 二、查询Dns服务器工作是否正常

1、确认自己的系统是windows 2000和windows xp以上操作系统，然后通过“开始-》运行-》输入CMD”后回车进入命令行模式。

2、输入ipconfig /all命令来查询网络参数。

3、 在ipconfig /all显示信息中我们能够看到一个地方写着DNS SERVERS，这个就是我们的DNS服务器地址。例如小编的是 118.123.8.174。从这个地址可以看出是个外网地址，如果使用外网DNS出现解析错误时，我们可以更换一个其他的Dns服务器地址即可解决问 题。

4、如果在DNS服务器处显示的是自己公司的内部网络地址，那么说明你们公司的DNS解析工作是交给公司内部的DNS服务器来完成 的，这时我们需要检查这个DNS服务器，在DNS服务器上进行nslookup操作看是否可以正常解析。解决 Dns服务器上的DNS服务故障，一般来说 问题也能够解决。

## 三、清除DNS缓存信息

当计算机对域名访问时，并不是每次都需要向 DNS服务器寻求请求帮助的，一般来说解析工作完成后，该解析条目会保存在计算机的DNS缓存列表中，如果这时DNS解析出现更改变动的话，由于DNS缓 存列表信息没有发生改变，在计算机对该域名访问时仍然不会连接DNS服务器获取最新的解析信息，会根据自己计算机上保存的缓存对应关系来解析，这样就会出 现DNS解析故障。可通过清除缓存命令来解决。

1、通过“开始-》运行-》输入CMD”后回车进入命令行模式；

2、执行ipconfig/flushdns命令，当出现“successfully flushed the dns resolver cache”的提示就说明当前计算机的缓存信息以及被成功清除。

3、接下来再去访问域名时，就会到DNS服务器商获取最新解析地址，再也不会出现一位缓存造成的解析故障。

## 四、修改hosts文件

修改hosts法就是把hosts文件中的DNS解析对应关系进行修改，从而实现正确的解析目的。因为本地计算机访问某个域名时会首先查看到本地系统中的 host文件，hosts文件中的解析关系优先级大于DNS服务器上的解析关系。这样我们就可通过在hosts文件中添加解析条目来实现。

1、找到hosts文件，文件路径：c:\windows\system32\drivers\etc目录下可找到hosts文件。

2、修双击hosts文件，选用记事本打开；

3、将你所希望进行DNS解析的条目增加到hosts文件中，格式：ip地址 域名 如：192.168.1.1;

4、设置完保存好，即可访问了。

# DNS 劫持是什么？

理解了DNS工用原理就不难理解DNS劫持，DNS劫持也叫DNS污染。比如说我想访问百度，百度的IP是182.61.200.61，当我在浏览器中输入了www.baidu.com之后正常来说DNS服务器会返还给我182.61.200.61，让我去访问这个IP，然后我就打开百度了。如果这个过程中出现了意外，比如说它返还给我另一个IP：58.56.170.199(新浪的IP)，这时候我明明输入了www.baidu.com但我访问的网站却变成了新浪，这就是我们说是DNS被劫持了。

![image-20220223182046537](https://jsl1997.oss-cn-beijing.aliyuncs.com/note/image-20220223182046537.png)

DNS被劫持的后果是很严重的，如果只是给我们返还一些广告的页面还好些，最多影响用户体验，如果有人把某个网站原封不动的自制下来去克隆一个一模一样的网站来盗取我们的个人信息，比如说一些账号密码之类的。而我们在前端跟本不知道，因为我们是输入域名进去的，我们不知道当前访问的网站是冒牌的，但实际上我们已经掉进别人陷阱中了。所以说DNS劫持或是NDS污染对访问者的影响是相当大的。而这种借助各种手段劫持或污染DNS的已被纳入了违法行为，会被判处破坏计算机信息系统罪。

## DNS被劫持了怎么办？

既然DNS劫持的危害这大，如果不幸我们电脑的DNS被劫持怎么办？解决方法其实很简单，只需要更改DNS设置就可以了，具体步骤如下：

### 本地DNS被劫持

我们在电脑使用过程不小心被值入了木马程序导致本地DNS被篡改，将用户重定向到恶意站点，这种情况只能影响到自己。

解决方法：打开控制面板->打开网络和共享中心->单击左侧更改适配器设置->双击本地连接->双击Internet协议版本4(TCP/IPv4)->弹出属性窗口。

如果我们的电脑DNS被劫持的话在“使用下面的DNS服务器地址”中‘首选DNS服务’或‘备用DNS服务器’的位置已被修改了。这时候我们只需点“自动获得DNS服务器地址”或者选择一组正确的DNS服务地址重新输入到首选DNS服务器和备用DNS服务器里面就可以了。（首选DNS服务器地址可以设为114.114.114.114，备选服务器地址可以设为114.114.115.115）。

### 路由器DNS被劫持

由于路由器密码泄漏或是固件有漏洞，被攻击者入侵了路由器并重设了DNS设置，这种情况会影响到连接到该路由器上的所有用户。

解决方案：在浏览器中输入路由器地址并输入账号密码（在路由器底部有写，路由器不一样登陆地址也不一样，例如我的是tplogin.cn）进入路由器页面->点击路由设置->点击DHCP服务器，把首选DNS服务器地址设为114.114.114.114，备选DNS服务器地址设为8.8.8.8，顺便修改下路由器登陆密码。